<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Venta de autos</title>
    <link rel="stylesheet" href="./gato.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script type="text/javascript">
        var count = 0;
        var conexion;
        var precio_auto, opcion, meses,mes;
        var cajas_radios;
        var prea, engan;
        var nom, pap, sap, tel, mod, pmensual;
        var modelo;
        
        addEvent(window,'load',cargar, false);
                 function addEvent(ele,eve,fun,cap){
                    if(window.attachEvent)
                      ele.addAttachEvent('on'+eve,fun);
                    else
                      ele.addEventListener(eve,fun,cap);
                 }
        
        function cargar() {
            addEvent(document.getElementById("combo"),'change',mostrarPrecioModelo,false);
            cajas_radios = document.getElementsByTagName("input"); 
                addEvent(cajas_radios[6],'keypress',filtraNumeros,false);
                 addEvent(cajas_radios[3],'keypress',filtraNumeros,false);
                 addEvent(cajas_radios[0],'keypress',filtraletras,false);
                 addEvent(cajas_radios[1],'keypress',filtraletras,false);
                 addEvent(cajas_radios[2],'keypress',filtraletras,false);
                addEvent(cajas_radios[7],'click',asignarmeses,false);
                addEvent(cajas_radios[8],'click',asignarmeses,false);
                addEvent(cajas_radios[9],'click',asignarmeses,false);

                addEvent(document.getElementById("btnp"),'click',calcularPago,false);

                addEvent(document.getElementById("btngd"),'click',leerValores,false);
        }

        function leerValores() {
            nom=document.getElementById("txtnombre").value;
                pap=document.getElementById("txtpap").value;
                sap=document.getElementById("txtsap").value;
                tel=document.getElementById("txttel").value;

                mod=document.getElementById("txtmod").value;
                pmensual=parseInt(document.getElementById("txtpagomensual").value);

           prea=parseInt(document.getElementById("txtprecioauto").value);
           engan=parseInt(document.getElementById("txtenganche").value);

            if (validaDatosCompletos()) {
                enviarValoresServidor();
            } else {
                Swal.fire('Error', 'Verifique falta algún dato', 'error');
            }
        }

        function enviarValoresServidor() {
            conexion = xmlhttprequest();
            conexion.onreadystatechange = esperaResultado;
            
             conexion.open("POST","auto.php",true);
           
             conexion.setRequestHeader("Content-type","application/x-www-form-urlencoded");  
           
             conexion.send("pa_php="+prea+"&en_php="+engan+"&m_php="+meses+"&nom_php="+nom+"&pap_php="+pap+"&sap_php="+sap+"&tel_php="+tel+"&mod_php="+mod+"&pm_php="+pmensual);
        }

        function esperaResultado() {
            count++;
            if (conexion.readyState == 4) {
                Swal.fire('Éxito', 'Datos guardados correctamente', 'success');
            }
        }

        function xmlhttprequest(){
           return new XMLHttpRequest();
           
       }

        function validaDatosCompletos() {
            if(!prea || !engan || !meses || !nom || !pap || !sap || !tel || !mod || !pmensual){
            return false;
         }
         else{
            return true;
         }
        }

        function asignarmeses() {
           if(cajas_radios[7].checked)   
                             meses=12;
                else if(cajas_radios[8].checked==true)
                             meses=24;
                else if(cajas_radios[9].checked==true)
                             meses=36;
                               enviarValoresServidor();
        }

        function mostrarPrecioModelo() {
           opcion=parseInt(document.getElementById("combo").value);
                        if(opcion==1){
                              precio_auto=120000;
                          modelo="Versa advanced";
                      }
                else if(opcion==2){
                              precio_auto=140000;
                          modelo="Mazda MX-5 2021";
                      }
                else if(opcion==3){
                              precio_auto=200000; 
                          modelo="Mazda MX-9 2022";
                      }
                    cajas_radios[5].value=precio_auto;
                    cajas_radios[4].value=modelo;
        }

        function calcularPago() {
            var pago_mensual,enganche;   
                          enganche=parseInt(document.getElementById("txtenganche").value);
                pago_mensual=(precio_auto-enganche)/meses;  
                document.getElementById("txtpagomensual").value=pago_mensual.toFixed(2);
        }

        function filtraNumeros() {
            if(  (event.keyCode>=48 && event.keyCode<=57)){
                     event.returnValue=true;
               } 
               else{
                    event.returnValue=false;
               }
        }

        function filtraletras() {
            if((event.keyCode>=97 & event.keyCode<=122) || (event.keyCode>=65 & event.keyCode<=90))
                    event.returnValue=true 
                else
                    event.returnValue=false
        }
    </script>
</head>
<body class="container mt-5">
    <div class="card p-4 shadow-lg">
        <h2 class="text-center mb-4">Venta de Autos</h2>
        <form>
            <div class="mb-3"><input type="text" class="form-control" id="txtnombre" placeholder="Nombre"></div>
            <div class="mb-3"><input type="text" class="form-control" id="txtpap" placeholder="Primer Apellido"></div>
            <div class="mb-3"><input type="text" class="form-control" id="txtsap" placeholder="Segundo Apellido"></div>
            <div class="mb-3"><input type="text" class="form-control" id="txttel" placeholder="Teléfono móvil"></div>
            <div class="mb-3">
                <select class="form-select" id="combo">
                    <option value="0">Seleccione un modelo</option>
                    <option value="1">Versa advanced</option>
                    <option value="2">Mazda MX-5 2021</option>
                    <option value="3">Mazda MX-9 2022</option>
                </select>
            </div>
            <div class="mb-3"><input type="text" class="form-control" id="txtmod" placeholder="Modelo"></div>
            <div class="mb-3"><input type="text" class="form-control" id="txtprecioauto" placeholder="Precio"></div>
            <div class="mb-3"><input type="text" class="form-control" id="txtenganche" placeholder="Enganche"></div>
            <div class="mb-3">
                <label class="form-label">Plazo de pago:</label><br>
                <input type="radio" name="rad" value="1"> 1 año
                <input type="radio" name="rad" value="2"> 2 años
                <input type="radio" name="rad" value="3"> 3 años
            </div>
            <div class="mb-3"><input type="text" class="form-control" id="txtpagomensual" value="0.0"></div>
            <button type="button" class="btn btn-primary" id="btnp">Calcular Pago</button>
            <button type="button" class="btn btn-success" id="btngd">Guardar Datos</button>
        </form>
    </div>
</body>
</html>
